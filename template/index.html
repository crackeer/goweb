
<div style="margin: 20px 0;">
    <a href="/page/link/edit" class="btn btn-primary btn-sm">管理书签</a>
    <a href="/page/markdown/create" class="btn btn-primary btn-sm">新建markdown文档</a>
    <a href="/page/code/create" class="btn btn-primary btn-sm">新建代码片段</a>
</div>
<div class="panel panel-primary">
    <div class="panel-body">
        <a href="/page/link/list" class="btn"><span class="glyphicon glyphicon-bookmark" aria-hidden="true"></span> 书签</a>
        <a href="/page/diary/list" class="btn"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> 日记</a>
        <a href="/page/markdown/list" class="btn"><span class="glyphicon glyphicon-blackboard" aria-hidden="true"></span> markdown文档</a>
        <a href="/page/code/list" class="btn"><span class="glyphicon glyphicon-text-size" aria-hidden="true"></span> 代码片段</a>
    </div>
</div>

<div style="margin-top: 30px;margin-bottom: 15px;">
    <h4><strong>快速记今日<small>（{{data.date}}）</small></strong></h4>
</div>

<div id="editor" style="margin-top: 20px;">
    <textarea style="display:none;"></textarea>
</div>
<div style="margin: 10px auto; text-align: center;">
<button class="btn btn-primary btn-sm" id="create" style="margin-bottom: 20px;">提交</button>
</div>

{% if("content" in data.object) %}
<div class="panel panel-default">
    <div class="panel-heading">
        今日 - {{data.date}}
    </div>
    <div class="panel-body">
        <div id="markdown-view">
            <textarea style="display:none;">{{data.object.content}}</textarea>
        </div>
    </div>
</div>
{%endif%}

<input type="hidden" value="{{data.object.id}}" id="diary-id">
<input type="hidden" value="{{data.date}}" id="diary-title">
<input type="hidden" value="{{data.object.content}}" id="diary-content">

<script text="text/javascript">
    $(document).ready(function () {
        editormd.markdownToHTML("markdown-view", {});
        var editor = editormd("editor", {
            width: "100%",
            height: '250px',
            //autoHeight      : true,
            toolbar : false ,     
            delay              : 1000,
            editorTheme: 'xq-light',
            path: "//cdn.jsdelivr.net/npm/editor.md@1.5.0/lib/",
            /*
            onchange: function () {
                let data = { id: parseInt($('#diary-id').val()), title: $('#diary-title').val(), content: this.getValue(), tag: $('#diary-title').val(), type: 'diary' }
                $.ajax({
                    method: 'post',
                    url: '/api/object/update',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (result) {
                        if (result.code != 0) {
                            alert("同步失败")
                        } else {
                            $('#diary-id').val(result.data.id)
                        }
                    }
                })
            }*/
            toolbarIcons : function () {
                // Or return editormd.toolbarModes[name]; // full, simple, mini
                // Using "||" set icons align right.
                return ["undo", "redo", "|", "bold", "hr", "|", "preview", "watch", "|", "fullscreen", "link", "table", "||", "watch", "fullscreen", "preview"]
            },
        });
        function current() {
            var d = new Date(),
                str = '';
            str += d.getFullYear() + '-'; //获取当前年份 
            str += d.getMonth() + 1 + '-'; //获取当前月份（0——11） 
            str += d.getDate() + ' ';
            str += d.getHours() + ':';
            str += d.getMinutes() + ':';
            str += d.getSeconds();
            return str;
        }

        $('#create').click(function(){
            let data = { id: parseInt($('#diary-id').val()), title: $('#diary-title').val(), content: editor.getValue(), tag: $('#diary-title').val(), type: 'diary' }
            data.content = "----\n#### " + current() + " \n" + data.content + "\n"
                $.ajax({
                    method: 'post',
                    url: '/api/object/append',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (result) {
                        if (result.code != 0) {
                            alert("同步失败")
                        } else {
                            window.location.reload()
                        }
                    }
                })
        })



    })
</script>