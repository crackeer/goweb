<div class="panel panel-primary">
    <div class="panel-body">
        <a href="/page/links" class="btn">书签</a>
        <a href="/page/edit_links" class="btn">管理书签</a>
        <a href="/page/diarys" class="btn">日记</a>
    </div>
</div>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/editor.md@1.5.0/css/editormd.min.css">
<script src="//cdn.jsdelivr.net/npm/editor.md@1.5.0/editormd.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/editor.md@1.5.0/lib/prettify.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/editor.md@1.5.0/lib/marked.min.js"></script>

<h3 class="text-danger"><strong>日记-{{data.date}}</strong></h3>
<div id="editor" style="margin-top: 20px;">
    <!-- Tips: Editor.md can auto append a `<textarea>` tag -->
    <textarea style="display:none;">{{data.diary.content}}</textarea>
</div>
<input type="hidden" value="{{data.diary.id}}" id="diary-id">
<input type="hidden" value="{{data.date}}" id="diary-title">
<input type="hidden" value="{{data.diary.content}}" id="diary-content">

<script text="text/javascript">
    $(document).ready(function () {

        var editor = editormd("editor", {
            width: "100%",
            height: '800px',
            //autoHeight      : true,
            //toolbar : false ,     
            delay              : 1000,
            editorTheme: 'xq-light',
            path: "//cdn.jsdelivr.net/npm/editor.md@1.5.0/lib/",
            onchange: function () {
                let data = { id: parseInt($('#diary-id').val()), title: $('#diary-title').val(), content: this.getValue(), tag: $('#diary-title').val(), type: 'diary' }
                $.ajax({
                    method: 'post',
                    url: '/api/object/update',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function (result) {
                        if (result.code != 0) {
                            alert("同步失败")
                        } else {
                            $('#diary-id').val(result.data.id)
                        }
                    }
                })
            },
            toolbarIcons : function () {
                // Or return editormd.toolbarModes[name]; // full, simple, mini
                // Using "||" set icons align right.
                return ["undo", "redo", "|", "bold", "hr", "|", "preview", "watch", "|", "fullscreen", "link", "table", "||", "watch", "fullscreen", "preview"]
            },
        });

    })
</script>