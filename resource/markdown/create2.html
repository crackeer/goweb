<link rel="stylesheet" href="https://unpkg.com/bytemd@1.11.0/dist/index.min.css" />
<link rel="stylesheet" href="https://unpkg.com/github-markdown-css" />
<script src="https://polyfill.io/v3/polyfill.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=Uint16Array,Array.prototype.find,smoothscroll"></script>
<script src="https://unpkg.com/bytemd@1.17.1/dist/index.umd.js"></script>
<script src="https://unpkg.com/@bytemd/plugin-gfm@1.17.1/dist/index.umd.js"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
<div id="app"></div>
<template id="template">
    <form class="form-horizontal">
        <div class="form-group">
            <label for="title" class="col-sm-1 control-label">标题</label>
            <div class="col-sm-11">
                <input type="text" class="form-control" v-model="title" placeholder="请输入标题">
            </div>
        </div>
    </form>
    <div id="editor" style="margin-top: 20px;">
        <!-- Tips: Editor.md can auto append a `<textarea>` tag -->
        <textarea style="display:none;"></textarea>
    </div>
    <form class="form-horizontal">
        <div class="form-group">
            <label for="title" class="col-sm-1 control-label">标签</label>
            <div class="col-sm-5">
                <input type="text" class="form-control" v-model="tag" placeholder="请输入标签">
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-1 col-sm-9">
                <label class="radio-inline" v-for="(item, i) in tag_list">
                    <input type="radio" name="tag" :value="item" v-model="tag">{{item}}
                </label>
            </div>
        </div>
    </form>
    <div style="margin: 20px auto; text-align: center;">
        <button type="button" class="btn btn-primary" @click="doCreate">创建</button>
    </div>
</template>

<script text="text/javascript">
    $(document).ready(function () {
        var vm = Vue.createApp({
            data() {
                let retData = __JS_DATA__.api_data
                retData['title'] = ""
                retData['content'] = ''
                retData['tag'] = ''
                retData["Editor"] = null
                return retData
            },
            template: '#template',
            mounted() {
                this.initEditor()
            },
            methods: {
                async initEditor() {
                    this.Editor = new bytemd.Editor({
                        target: document.getElementById("editor"),
                        props: {
                            value: ""
                        },
                        plugins: [bytemdPluginGfm()]
                    });
                    this.Editor.$on('change',  (e) => {
                        
                        this.Editor.$set({ value: e.detail.value });
                    });
                },
                async doCreate() {
                    let nowTime = dayjs().format('YYYY-MM-DD HH:mm:ss')
                    let data = {
                        title: this.title,
                        content: this.Editor.getValue(),
                        tag: this.tag,
                        create_time: nowTime,
                        update_time: nowTime
                    }
                    if (this.title.trim().length < 1) {
                        alert('请输入标题')
                    }
                    if (this.tag.trim().length < 1) {
                        alert('请选择tag')
                    }
                    console.log(data)
                    let result = await axios.post('/api/goapi/base_object_create', data)
                    window.location.href = "/markdown/list?tag=" + this.tag

                }
            }
        })
        vm.mount('#app')
    })
</script>
<style>
    .bytemd {
        height: calc(100vh - 100px);
    }
</style>